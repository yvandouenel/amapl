From 000a81773d509a0ea84820b5dc798863e30514ca Mon Sep 17 00:00:00 2001
From: Edouard Cunibil <admin@duael.fr>
Date: Sun, 20 Jul 2014 18:17:37 +0200
Subject: [PATCH] Issue #1946058 by matthensley: Fixed Default values from the
 field instance are never used.

---
 geofield.widgets.inc |   12 ++++++++++++
 1 file changed, 12 insertions(+)

diff --git a/geofield.widgets.inc b/geofield.widgets.inc
index 2eafef4..24c8fa0 100644
--- a/geofield.widgets.inc
+++ b/geofield.widgets.inc
@@ -112,6 +112,9 @@ function geofield_field_widget_form(&$form, &$form_state, $field, $instance,
   switch ($widget['type']) {
     case 'geofield_wkt':
       $default_value = '';
+      if (!empty($instance['default_value'][0]['geom'])) {
+        $default_value = $instance['default_value'][0]['geom'];
+      }
       if (!empty($items[$delta]['geom'])) {
         geophp_load();
         $geometry = geoPHP::load($items[$delta]['geom']);
@@ -129,6 +132,9 @@ function geofield_field_widget_form(&$form, &$form_state, $field, $instance,
       break;
     case 'geofield_geojson':
       $default_value = '';
+      if (!empty($instance['default_value'][0]['geom'])) {
+        $default_value = $instance['default_value'][0]['geom'];
+      }
       if (!empty($items[$delta]['geom'])) {
         geophp_load();
         $geometry = geoPHP::load($items[$delta]['geom']);
@@ -150,6 +156,9 @@ function geofield_field_widget_form(&$form, &$form_state, $field, $instance,
         'lat' => '',
         'lon' => '',
       );
+      if (!empty($instance['default_value'][0]['geom'])) {
+        $latlon_value = $instance['default_value'][0]['geom'];
+      }
       if (isset($items[$delta]['lat'])) {
         $latlon_value['lat'] = floatval($items[$delta]['lat']);
       }
@@ -174,6 +183,9 @@ function geofield_field_widget_form(&$form, &$form_state, $field, $instance,
         'bottom' => '',
         'left' => '',
       );
+      if (!empty($instance['default_value'][0]['geom'])) {
+        $bounds_value = $instance['default_value'][0]['geom'];
+      }
       if (isset($items[$delta]['top'])) {
         $bounds_value['top'] = floatval($items[$delta]['top']);
       }
-- 
1.7.10.4

